# ğŸ’¬ å¯¹è¯äº¤äº’è®¾è®¡

> **å­¦ä¹ ç›®æ ‡**ï¼šè®¾è®¡è‡ªç„¶ã€é«˜æ•ˆçš„AIå¯¹è¯ä½“éªŒ

---

## 1. å¯¹è¯è®¾è®¡åŸåˆ™

### 1.1 ç”¨æˆ·æœŸæœ›ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯¹è¯è®¾è®¡é‡‘å­—å¡”                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚   æ„‰æ‚¦æ„Ÿ    â”‚ â† ä¸ªæ€§åŒ–ã€å¹½é»˜æ„Ÿ             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                   â”‚    æ•ˆç‡æ„Ÿ     â”‚ â† å¿«é€Ÿè§£å†³é—®é¢˜              â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚       å¯æ§æ„Ÿ            â”‚ â† èƒ½ä¿®æ”¹ã€èƒ½ä¸­æ–­        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚          å¯é¢„æµ‹æ„Ÿ                  â”‚ â† çŸ¥é“AIèƒ½åšä»€ä¹ˆ  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚                 ä¿¡ä»»æ„Ÿ                        â”‚ â† æ­£ç¡®ã€å®‰å…¨  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å¯¹è¯æµç¨‹è®¾è®¡

### 2.1 å¼€åœºè®¾è®¡

```python
class ConversationOpener:
    """å¯¹è¯å¼€åœºè®¾è®¡"""
    
    def __init__(self, product_name: str, capabilities: list[str]):
        self.product_name = product_name
        self.capabilities = capabilities
    
    def generate_greeting(self, user_name: str = None, time_of_day: str = "day") -> str:
        """ç”Ÿæˆä¸ªæ€§åŒ–é—®å€™"""
        time_greetings = {
            "morning": "æ—©ä¸Šå¥½",
            "afternoon": "ä¸‹åˆå¥½",
            "evening": "æ™šä¸Šå¥½",
            "day": "ä½ å¥½"
        }
        
        greeting = time_greetings.get(time_of_day, "ä½ å¥½")
        
        if user_name:
            greeting = f"{greeting}ï¼Œ{user_name}"
        
        # å±•ç¤ºèƒ½åŠ›
        cap_list = "ã€".join(self.capabilities[:3])
        
        return f"""{greeting}ï¼ğŸ‘‹

æˆ‘æ˜¯{self.product_name}ï¼Œå¯ä»¥å¸®ä½ {cap_list}ç­‰ã€‚

æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"""

# ä½¿ç”¨
opener = ConversationOpener(
    "æ™ºèƒ½åŠ©æ‰‹",
    ["å›ç­”é—®é¢˜", "æ–‡æ¡£åˆ†æ", "ä»£ç ç¼–å†™", "ç¿»è¯‘"]
)
greeting = opener.generate_greeting("å¼ ä¸‰", "morning")
```

### 2.2 å¼•å¯¼å¼å¯¹è¯

```python
class GuidedConversation:
    """å¼•å¯¼å¼å¯¹è¯"""
    
    def __init__(self):
        self.conversation_tree = {
            "start": {
                "message": "è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",
                "options": [
                    {"text": "ğŸ“„ æ–‡æ¡£å¤„ç†", "next": "document"},
                    {"text": "ğŸ’¬ é—®ç­”å’¨è¯¢", "next": "qa"},
                    {"text": "ğŸ”§ æŠ€æœ¯æ”¯æŒ", "next": "support"}
                ]
            },
            "document": {
                "message": "æ‚¨æƒ³å¯¹æ–‡æ¡£åšä»€ä¹ˆæ“ä½œï¼Ÿ",
                "options": [
                    {"text": "ğŸ“– æ–‡æ¡£æ€»ç»“", "next": "summarize"},
                    {"text": "ğŸ” ä¿¡æ¯æå–", "next": "extract"},
                    {"text": "ğŸ“ æ–‡æ¡£é—®ç­”", "next": "doc_qa"}
                ]
            }
        }
    
    def get_node(self, node_id: str) -> dict:
        """è·å–å¯¹è¯èŠ‚ç‚¹"""
        return self.conversation_tree.get(node_id, self.conversation_tree["start"])
    
    def format_options(self, node: dict) -> str:
        """æ ¼å¼åŒ–é€‰é¡¹"""
        message = node["message"]
        options = node.get("options", [])
        
        if options:
            message += "\n\nè¯·é€‰æ‹©ï¼š"
            for i, opt in enumerate(options, 1):
                message += f"\n{i}. {opt['text']}"
        
        return message

# ä½¿ç”¨
guide = GuidedConversation()
node = guide.get_node("start")
print(guide.format_options(node))
```

---

## 3. å›å¤è®¾è®¡æ¨¡å¼

### 3.1 ç»“æ„åŒ–å›å¤

```python
class ResponseFormatter:
    """å›å¤æ ¼å¼åŒ–å™¨"""
    
    def format_answer(
        self,
        answer: str,
        sources: list[str] = None,
        confidence: float = None,
        follow_ups: list[str] = None
    ) -> str:
        """æ ¼å¼åŒ–å›ç­”"""
        response = answer
        
        # æ·»åŠ ç½®ä¿¡åº¦æç¤º
        if confidence is not None and confidence < 0.7:
            response = "âš ï¸ æˆ‘å¯¹è¿™ä¸ªå›ç­”ä¸å¤ªç¡®å®šï¼š\n\n" + response
        
        # æ·»åŠ æ¥æº
        if sources:
            response += "\n\nğŸ“š **å‚è€ƒæ¥æº**ï¼š"
            for i, src in enumerate(sources, 1):
                response += f"\n{i}. {src}"
        
        # æ·»åŠ è¿½é—®å»ºè®®
        if follow_ups:
            response += "\n\nğŸ’¡ **æ‚¨å¯èƒ½è¿˜æƒ³é—®**ï¼š"
            for q in follow_ups[:3]:
                response += f"\nâ€¢ {q}"
        
        return response
    
    def format_error(self, error_type: str, suggestion: str) -> str:
        """æ ¼å¼åŒ–é”™è¯¯æç¤º"""
        error_messages = {
            "not_found": "æŠ±æ­‰ï¼Œæˆ‘æ²¡èƒ½æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚",
            "unclear": "æŠ±æ­‰ï¼Œæˆ‘ä¸å¤ªç†è§£æ‚¨çš„é—®é¢˜ã€‚",
            "out_of_scope": "æŠ±æ­‰ï¼Œè¿™ä¸ªé—®é¢˜è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›èŒƒå›´ã€‚"
        }
        
        message = error_messages.get(error_type, "æŠ±æ­‰ï¼Œå‡ºç°äº†ä¸€äº›é—®é¢˜ã€‚")
        return f"{message}\n\nğŸ’¡ **å»ºè®®**ï¼š{suggestion}"

# ä½¿ç”¨
formatter = ResponseFormatter()
response = formatter.format_answer(
    "Pythonæ˜¯ä¸€é—¨é«˜çº§ç¼–ç¨‹è¯­è¨€...",
    sources=["Pythonå®˜æ–¹æ–‡æ¡£", "ç»´åŸºç™¾ç§‘"],
    confidence=0.95,
    follow_ups=["Pythoné€‚åˆåšä»€ä¹ˆï¼Ÿ", "å¦‚ä½•å­¦ä¹ Pythonï¼Ÿ"]
)
```

### 3.2 æ¸è¿›å¼å±•ç¤º

```python
async def stream_with_sections(answer: str):
    """åˆ†æ®µæµå¼è¾“å‡º"""
    sections = answer.split("\n\n")
    
    for section in sections:
        # å…ˆæ˜¾ç¤ºæ ‡é¢˜
        if section.startswith("#"):
            yield section + "\n\n"
            await asyncio.sleep(0.3)
        else:
            # é€å­—æ˜¾ç¤ºæ­£æ–‡
            for char in section:
                yield char
                await asyncio.sleep(0.01)
            yield "\n\n"
```

---

## 4. é”™è¯¯å¤„ç†è®¾è®¡

### 4.1 ä¼˜é›…é™çº§

```python
class GracefulDegradation:
    """ä¼˜é›…é™çº§å¤„ç†"""
    
    def __init__(self):
        self.fallback_responses = {
            "api_error": "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•ã€‚æ‚¨ä¹Ÿå¯ä»¥å°è¯•ç®€åŒ–é—®é¢˜é‡æ–°æé—®ã€‚",
            "timeout": "å“åº”æ—¶é—´è¾ƒé•¿ï¼Œæˆ‘æ­£åœ¨å¤„ç†ä¸­ã€‚æ‚¨å¯ä»¥ç¨ç­‰æˆ–æ¢ä¸ªé—®æ³•è¯•è¯•ã€‚",
            "no_result": "æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚æ‚¨å¯ä»¥æ¢ä¸ªå…³é”®è¯æœç´¢ï¼Œæˆ–æä¾›æ›´å¤šç»†èŠ‚ã€‚",
            "sensitive": "æŠ±æ­‰ï¼Œè¿™ä¸ªè¯é¢˜æˆ‘æ— æ³•è®¨è®ºã€‚æœ‰å…¶ä»–æˆ‘å¯ä»¥å¸®åŠ©çš„å—ï¼Ÿ"
        }
    
    def handle_error(self, error_type: str, context: dict = None) -> dict:
        """å¤„ç†é”™è¯¯"""
        message = self.fallback_responses.get(
            error_type,
            "å‡ºç°äº†ä¸€ç‚¹é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚"
        )
        
        return {
            "message": message,
            "show_options": True,
            "options": [
                "é‡æ–°æé—®",
                "æ¢ä¸ªè¯é¢˜",
                "è”ç³»äººå·¥å®¢æœ"
            ]
        }

# ä½¿ç”¨
degradation = GracefulDegradation()
fallback = degradation.handle_error("timeout")
```

---

## 5. å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£å¯¹è¯è®¾è®¡é‡‘å­—å¡”
- [ ] èƒ½å¤Ÿè®¾è®¡å¼•å¯¼å¼å¯¹è¯æµç¨‹
- [ ] ä¼šæ ¼å¼åŒ–ç»“æ„åŒ–å›å¤
- [ ] èƒ½å¤Ÿå®ç°ä¼˜é›…é™çº§

---

## ç»§ç»­å­¦ä¹ 

ğŸ“Œ **Week 10 å­¦ä¹ é¡ºåº**ï¼š
1. âœ… AIäº§å“è®¾è®¡åŸåˆ™
2. âœ… å¯¹è¯äº¤äº’è®¾è®¡ï¼ˆæœ¬æ•™ç¨‹ï¼‰
3. â¡ï¸ é”™è¯¯å¤„ç†ç­–ç•¥
